# NEW COMBAT SYSTEM

Copy all following code.
More info at 

```javascript
function onPlayerDamagingOtherPlayer(e,t,a,i){if(api.getEffects(t).includes("Invincible"))return"preventDamage";if(e!=t){if(api.getEffects(e).includes("Attack Cooldown")||api.isPlayerCrouching(e))return"preventDamage";if(api.applyEffect(e,"Attack Cooldown",500,{inbuiltLevel:1,icon:i,displayName:"Attack Cooldown"}),api.getEffects(t).includes("Offhand Shield")&&!api.getEffects(t).includes("Broken Shield")&&api.isPlayerCrouching(t)){if(api.getHeldItem(e)?.name?.includes("Axe"))api.applyEffect(t,"Broken Shield",6e3,{displayName:"Broken Shield",icon:"Brown Paintball"}),api.playSound(t,"fallsmall",1,1),api.playSound(e,"fallsmall",1,1);else{let[a,i,o]=api.getPosition(e),[l,n,f]=api.getPosition(t),p=[a-l,i-n,o-f];api.applyMeleeHit(t,e,p);try{api.applyHealthChange(e,4)}catch(e){}api.playSound(e,"wood"+Math.round(4*Math.random()+.5),1,1),api.playSound(t,"wood"+Math.round(4*Math.random()+.5),1,1)}return"preventDamage"}if(api.getEffects(t).includes("Offhand Totem")){if(!(api.getHealth(t)-a>0)){api.getSelectedInventorySlotI(t);return api.removeEffect(t,"Offhand Totem"),api.setHealth(t,1),api.applyEffect(t,"Health Regen",15e3,{inbuiltLevel:2}),api.applyEffect(t,"Heat Resistance",1e4,{}),api.applyEffect(t,"Invincible",2e3,{icon:"Iron Chestplate",displayName:"Invincible"}),totemParticles(api.getPosition(t)),api.playSound(e,"cannonFire1",1,1),api.playSound(e,"cashRegister",1,1),api.playSound(t,"cannonFire1",1,1),api.playSound(t,"cashRegister",1,1),"preventDamage"}}}}function onPlayerKilledOtherPlayer(e,t){api.clearInventory(t)}function tick(){if(50*Date.now()%20==0)for(const e of api.getPlayerIds())displayOffhandItem(e)}function displayOffhandItem(e){api.getEffects(e).includes("Offhand Shield")&&api.isPlayerCrouching(e)&&!api.getEffects(e).includes("Broken Shield")?api.updateEntityNodeMeshAttachment(e,"TorsoNode","BloxdBlock",{blockName:"Brown Paintball",size:.5,meshOffset:[0,0,0]},[.4,.3,.4],[110,3.15,0]):api.getEffects(e).includes("Offhand Shield")?api.updateEntityNodeMeshAttachment(e,"TorsoNode","BloxdBlock",{blockName:"Brown Paintball",size:.5,meshOffset:[0,0,0]},[.5,.3,0],[110,80.1,0]):api.getEffects(e).includes("Offhand Totem")&&api.updateEntityNodeMeshAttachment(e,"TorsoNode","BloxdBlock",{blockName:"Yellow Paintball",size:.15,meshOffset:[0,0,0]},[0,1.5,0],[0,0,0])}function totemParticles(e){let[t,a,i]=e;a+=1,api.playParticleEffect({dir1:[-1,-1,-1],dir2:[1,1,1],pos1:[t,a,i],pos2:[t,a,i],texture:"glint",minLifeTime:.2,maxLifeTime:.6,minEmitPower:2,maxEmitPower:5,minSize:.25,maxSize:.35,manualEmitCount:100,gravity:[0,0,0],colorGradients:[{timeFraction:0,minColor:[255,255,0,1],maxColor:[0,255,0,1]}],velocityGradients:[{timeFraction:0,factor:1,factor2:1}],blendMode:1})}function onPlayerClick(e,t){if(t&&"Brown Paintball"==api.getHeldItem(e)?.name&&!api.getEffects(e).includes("Offhand")){let t=api.getSelectedInventorySlotI(e);return api.setItemSlot(e,t,"Air"),api.getEffects(e).includes("Offhand Totem")&&(api.removeEffect(e,"Offhand Totem"),api.setItemSlot(e,t,"Yellow Paintball",null,{customDisplayName:"Totem of Undying",customDescription:"Hold in offhand to survive your death."})),api.applyEffect(e,"Offhand Shield",null,{icon:"Brown Paintball",displayName:"Offhand"}),void displayOffhandItem(e)}if(api.getEffects(e).includes("Attack Cooldown")){let t=api.getHeldItem(e)?.name;api.applyEffect(e,"Attack Cooldown",500,{inbuiltLevel:1,icon:t,displayName:"Attack Cooldown"})}if(t&&"Yellow Paintball"==api.getHeldItem(e)?.name&&!api.getEffects(e).includes("Offhand Totem")){let t=api.getSelectedInventorySlotI(e);return api.setItemSlot(e,t,"Air"),api.getEffects(e).includes("Offhand Shield")&&(api.removeEffect(e,"Offhand Shield"),api.setItemSlot(e,t,"Brown Paintball",null,{customDisplayName:"Shield",customDescription:"Hold in offhand to block attacks."})),api.applyEffect(e,"Offhand Totem",null,{icon:"Yellow Paintball",displayName:"Offhand"}),void displayOffhandItem(e)}if(null==api.getHeldItem(e)){let t=api.getSelectedInventorySlotI(e);api.getEffects(e).includes("Offhand Shield")&&(api.removeEffect(e,"Offhand Shield"),api.setItemSlot(e,t,"Brown Paintball",null,{customDisplayName:"Shield",customDescription:"Hold in offhand to block attacks."})),api.getEffects(e).includes("Offhand Totem")&&(api.removeEffect(e,"Offhand Totem"),api.setItemSlot(e,t,"Yellow Paintball",null,{customDisplayName:"Totem of Undying",customDescription:"Hold in offhand to survive your death."}))}}function onPlayerLeave(e){api.getEffects(e).includes("Offhand Shield")?api.giveItem(e,"Brown Paintball",null,{customDisplayName:"Shield",customDescription:"Hold in offhand to block attacks."}):api.getEffects(e).includes("Offhand Totem")&&api.giveItem(e,"Yellow Paintball",null,{customDisplayName:"Totem of Undying",customDescription:"Hold in offhand to survive your death."})}function onPlayerAttemptCraft(e,t){return"Brown Paintball"==t?(api.removeItemName(e,"Maple Wood Planks",6),api.removeItemName(e,"Iron Bar",1),api.giveItem(e,"Brown Paintball",null,{customDisplayName:"Shield",customDescription:"Hold in offhand to block attacks."}),api.sendMessage(e,"Right click to apply to offhand, sneak to block attacks."),"preventCraft"):"Yellow Paintball"==t?(api.removeItemName(e,"Gold Bar",4),api.removeItemName(e,"Block of Gold",1),api.removeItemName(e,"Diamond",2),api.giveItem(e,"Yellow Paintball",null,{customDisplayName:"Totem of Undying",customDescription:"Hold in offhand to survive your death."}),api.sendMessage(e,"Right click to apply to offhand, lets you survive your death when applied there!"),"preventCraft"):t.includes("Milk")?"preventCraft":void 0}function onPlayerJoin(e){recipe=[{requires:[{items:["Maple Wood Planks"],amt:6},{items:["Iron Bar"],amt:1}],produces:1,station:"Workbench"}],api.editItemCraftingRecipes(e,"Brown Paintball",recipe),recipe=[{requires:[{items:["Gold Bar"],amt:4},{items:["Block of Gold"],amt:1},{items:["Diamond"],amt:2}],produces:1,station:"Workbench"}],api.editItemCraftingRecipes(e,"Yellow Paintball",recipe)}function onInventoryUpdated(e){if(api.hasItem(e,"Milk Potion")||api.hasItem(e,"Splash Milk Potion")||api.hasItem(e,"Arrow of Milk")){let t=api.getInventoryItemAmount(e,"Milk Potion"),a=api.getInventoryItemAmount(e,"Splash Milk Potion"),i=api.getInventoryItemAmount(e,"Arrow of Milk");api.removeItemName(e,"Milk Potion",t),api.removeItemName(e,"Splash Milk Potion",a),api.removeItemName(e,"Arrow of Milk",i),api.giveItem(e,"Empty Bottle",t+a+i)}}

```
